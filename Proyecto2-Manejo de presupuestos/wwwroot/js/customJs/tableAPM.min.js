var  row_num = 11, countRow=0,classes = [];
  tableSearch = function(e) {
    $("#ampInput").on("keyup", function(e) {
        //$('.extraInfo').removeClass("activeExtra");   
        // $('.apmBox').css({"display": "none"});
        var value = $(this).val().toLowerCase();
        $("input[name='filter-element']").prop("checked", false);

        $(".table-apm tbody tr.row").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1).removeClass('inActive');
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1).addClass('active');
          $('.showDiv').css({"display": "none"});
          var countRow=0; 
          $(".table-apm tbody tr.row").each(function(){
            
            if($(this).css('display') == 'table-row'){
              countRow++;
            }
          });
          
            if($(this).css('display') == "table-row" && countRow == 1){
            
             // $('.extraInfo').removeClass("activeExtra");     
              //$(this).next().addClass("activeExtra");    

              
            }
            if(e.keyCode == 8) {
              
             // $('.extraInfo').removeClass("activeExtra");   

            }

        });

        if($("#ampInput").val()==""){
          $('.showDiv').css({"display": "block"});
          // $('.apmBox').css({"display": "none"});
          $('.extraInfo').removeClass("activeExtra");    
          $(".table-apm tbody tr.row").removeClass('active');
          $(".table-apm tbody tr.row").addClass('inActive');
          $(".table-apm tbody tr.row:lt("+row_num+")").removeClass('inActive');
          $(".table-apm tbody tr.row:lt("+row_num+")").addClass('active');
        }
        colorTable();
      });

  },
  tableFilter = function() {
      $("input[name='filter-element']").change(function () {
        $("#ampInput").val("");

        var classes = [];

        var classesCountry = [];
        var classesMethod = [];

        var countMethod = $(".filter-group.method .filter-element input:checked").length;//number of name checked items
        var countCountry = $(".filter-group.country .filter-element input:checked").length;//number of name checked items
        
        var checkEurope = $(".checkEurope").prop('checked');
        var checkGlobal = $(".checkGlobal").prop('checked');
        var checkAfrica = $(".checkAfrica").prop('checked');
        var checkAsia = $(".checkAsia").prop('checked');
        var checkLatam = $(".checkLatam").prop('checked');
        if(checkEurope==true && checkGlobal ==true && checkAfrica ==true && checkAsia ==true && checkLatam ==true){
          $('.filter-element.country').css({"opacity": ".3"});
          $('.filter-element.country input').prop('disabled', true);
          event.preventDefault();
          event.stopPropagation();
        }else{
          $('.filter-element.country').css({"opacity": "1"});
          $('.filter-element.country input').prop('disabled', false);
        }

        $("input[name='filter-element']").each(function () {

            if ($(this).is(":checked")) { 




              filterClass = $(this).parent().parent().attr('class');
              var values = filterClass.split(" ");
              var filterClassname = values[1];

 
              if(filterClassname=="country"){
                classesCountry.push('.' + $(this).val()); 
              }
              if(filterClassname=="method"){
                classesMethod.push('.' + $(this).val()); 
              }


              classes.push('.' + $(this).val()); 
            }
            
        });

        if (countMethod == 0 && countCountry == 0) { // if no filters selected, show all items
          // $('.apmBox').css({"display": "none"});
          $('.extraInfo').removeClass("activeExtra");    
          $('a.load_less').css({"display": "none"});
          $('a.load_more').css({"display": "block"});
          $(".table-apm tbody tr.row").removeClass('active');
          $(".table-apm tbody tr.row").addClass('inActive');
          $(".table-apm tbody tr.row:lt("+row_num+")").removeClass('inActive');
          $(".table-apm tbody tr.row:lt("+row_num+")").addClass('active');
          colorTable();
        } else { // otherwise, hide everything...
            // $('.apmBox').css({"display": "none"});
            $('.extraInfo').removeClass("activeExtra");    
            $('a.load_less').css({"display": "none"});
            $('a.load_more').css({"display": "none"});
            $(".table-apm tbody tr.row").removeClass('active');
            $(".table-apm tbody tr.row").addClass('inActive');
            $("#apmTableContent tr.row").each(function () {
                var show = false;
                var row = $(this);
              if((countMethod > 0 && countCountry == 0) ||Â (countMethod == 0 && countCountry > 0)){
                //Busqueda con OR
                 classes.forEach(function (className) {
                    if (row.find('td' + className).html()) { show = true; }
                });

              }else{
                //junta los elementos del array con resultados generales entre si
                if(countMethod>countCountry){
                  var filterGrater = countMethod;
                }else if(countCountry>countMethod){
                  var filterGrater = countCountry;
                }else if(countCountry=countMethod){
                  var filterGrater = countCountry;
                }else if(countCountry== 1 && countMethod== 1){
                  var filterGrater = 1;
                }
                
                let finalset = []
              
                for (let i = 0; i < classes.length/filterGrater; i++) {
                  let others = classes.filter(name => name != classes[i])
                  others.forEach((other) => {
                
                    let newel = classes[i] + other
                    let test = newel.split('|')
                    if (finalset.includes(test[1] + '|' + test[0]) || finalset.includes(newel)) return
                
                    finalset.push(newel)
                  })
                
                }

                

                //Si metodo tiene mas de 1 elemento seleccionado
                if(countMethod>=2){
                  
                   let auxiliarArray = []
                    //junta los elementos del array con resultados especificos entre si
                   for (let i = 0; i < classesMethod.length; i++) {
                     let others = classesMethod.filter(name => name != classesMethod[i])
                     others.forEach((other) => {
                   
                       let newel = classesMethod[i] + other
                       let test = newel.split('|')
                       if (auxiliarArray.includes(test[1] + '|' + test[0]) || auxiliarArray.includes(newel)) return
                   
                       auxiliarArray.push(newel)
                     })
                   
                   }
                    //Elimina los elementos del array con resultados especificos entre si del array general
                   for (let i = 0; i < auxiliarArray.length; i++) {
 
                     var index = finalset.indexOf(auxiliarArray[i]);
                     if (index > -1) {
                       finalset.splice(index, 1);
                     }
 
                   }

                }
                //Si pais tiene mas de 1 elemento seleccionado
                if(countCountry>=2){

                  let auxiliarArray = []
                //junta los elementos del array con resultados especificos entre si
                  for (let i = 0; i < classesCountry.length; i++) {
                    let others = classesCountry.filter(name => name != classesCountry[i])
                    others.forEach((other) => {
                  
                      let newel = classesCountry[i] + other
                      let test = newel.split('|')
                      if (auxiliarArray.includes(test[1] + '|' + test[0]) || auxiliarArray.includes(newel)) return
                  
                      auxiliarArray.push(newel)
                    })
                  
                  }
                        //Elimina los elementos del array con resultados especificos entre si del array general
                  for (let i = 0; i < auxiliarArray.length; i++) {

                    var index = finalset.indexOf(auxiliarArray[i]);
                    if (index > -1) {
                      finalset.splice(index, 1);
                    }

                  }
               

                }

                // //Busqueda con AND
                finalset.forEach(function (className,index,array) {

                   
              
                     if (row.filter(className).length) { show = true;}
                 });  
              }  

                if (show){ 
                  row.removeClass('inActive');
                  row.addClass('active');
                  if($(".table-apm tbody tr.row.active").length == 1){
                    $('.extraInfo').removeClass("activeExtra");     
                    $(this).next().addClass("activeExtra");    

                  }else{
                    $('.extraInfo').removeClass("activeExtra");    

                  }
              }
            });
            colorTable();
        }
        
    });
  },
  tableLoadMore = function() {
    $('.table-apm tbody tr.row:lt('+row_num+')').addClass('active');

    $('a.load_more').on('click', function(e) {
      /* row_num = row_num + 1; */
      e.preventDefault();  
      var $rows = $('.table-apm tr.row');
      var lastActiveIndex = $rows.filter('.active:last').index();
      /* cambiar 100 a 3 para sumar de 1 en 1 */
      $rows.filter(':lt(' + (lastActiveIndex + 100) + ')').removeClass('inActive');
      $rows.filter(':lt(' + (lastActiveIndex + 100) + ')').addClass('active');
      var rowCount = $('.table-apm tr.row').length;
      var rowCountActive = $('.table-apm tr.row.active').length;
      if (rowCount == rowCountActive){
        $('a.load_more').css({"display": "none"});
        $('a.load_less').css({"display": "block"});
      }
      colorTable();
    });
  },
  tableLoadLess = function() {
    $('a.load_less').on('click', function(e) {

      e.preventDefault();  
      $('.table-apm tbody tr.row').removeClass('active');
      $('.table-apm tbody tr.row').addClass('inActive');
      $('.table-apm tbody tr.row:lt('+row_num+')').removeClass('inActive');
      $('.table-apm tbody tr.row:lt('+row_num+')').addClass('active');
      var rowCountActive = $('.table-apm tr.row.active').length;
      if (row_num == rowCountActive){
        $('a.load_less').css({"display": "none"});
        $('a.load_more').css({"display": "block"});
      }
      $('html,body').animate({scrollTop: $('.table-apm-container').offset().top},'easeInSine');
      colorTable();
    });
  },
  colDescription = function() {
    $( ".colDesc" ).hover(
      function() {
        var urlEN =  window.location.href;
        var desc = $( this ).attr("data-desc");
          if(urlEN.includes('/en/')){
              $( this ).append( $( "<span class='boxDesc en'>"+desc+"</span>" ) );
            }else{
              $( this ).append( $( "<span class='boxDesc'>"+desc+"</span>" ) );
            }
        
      }, function() {
         $( this ).find( "span" ).last().remove();
       
      }
    );
  },
  filterLoadMore = function() {
    $('.filter-group.country label:lt(21)').addClass('active');
    $('.filter-group.country a.load_more_filter').on('click', function(e) {
      e.preventDefault();  
      
      $('.filter-country-list').css({"overflow-y": "scroll"});
      var $rows = $('.filter-group.country label');
      var lastActiveIndex = $rows.filter('.active:last').index();
       /* cambiar 100 a 3 para sumar de 1 en 1 */
      $rows.filter(':lt(' + (lastActiveIndex + 100) + ')').addClass('active');
      var rowCount = $('.filter-group.country label').length;
      var rowCountActive = $('.filter-group.country label.active').length;
      if (rowCount == rowCountActive){
        $('.filter-group.country a.load_more_filter').css({"display": "none"});
        $('.filter-group.country a.load_less_filter').css({"display": "block"});
      }
      
    });
  },
  filterLoadLess = function() {
    $('.filter-group.country a.load_less_filter').on('click', function(e) {
      e.preventDefault();  
      $('.filter-group.country label').removeClass('active');
      $('.filter-group.country label').addClass('inActive');
      $('.filter-group.country label:lt(21)').addClass('active');
      $('.filter-country-list').css({"overflow-y": "hidden"});
      var rowCountActive = $('.filter-group.country label.active').length;
      if (rowCountActive  == 21){
        $('.filter-group.country a.load_less_filter').css({"display": "none"});
        $('.filter-group.country a.load_more_filter').css({"display": "block"});
      }
    });
  },
  colorTable = function() {
    var x=2;
    $(".table-apm tr.row.active").each(function () {
      if(($(this).hasClass('active')) && ($(this).css('display') != 'none')){
        
        	if (x%2 == 0){
            $(this).css({"background-color": "#f6f9fe"});
          }else{
            $(this).css({"background-color": "#fff"});
          }
          x++;
      }
    });
    var x=0;
  },
  hideFilter = function() {
    $('.filter-buttom').on('click', function(e) {
      e.preventDefault();  
      $('.filter-apm-group').hide();
      $('.table-apm-group').css({"width": "100%", "padding-right": "3em"});
      $('.form-control').css({"width": "86%"});
      $('.filter-buttom-show').css({"display": "inline"});
    }); 
    $('.filter-buttom-show').on('click', function(e) {
      e.preventDefault();  
      $('.filter-buttom-show').css({"display": "none"});
      $('.filter-apm-group').show();
      $('.table-apm-group').css({"width": "83%", "padding-right": "0em"});
      $('.form-control').css({"width": "96%"});
    }); 

  };
jQuery(document).ready(function() {
   hideFilter(), filterLoadLess(),filterLoadMore(), tableLoadLess(), tableLoadMore(), tableFilter(), tableSearch(), colDescription(), colorTable();
});